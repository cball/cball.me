<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Understanding Loading Substates in Ember</title><meta content="width=device-width, initial-scale=1" name="viewport" /><meta content="Level up your development skills | Chris Ball" name="og:site_name" /><meta content="blog" name="og:type" /><meta content="Ember applications (and client-side applications in general) respond quickly to user interaction. In a perfect world, the API powering your application also responds quickly, but unfortunately most of us don’t live in a perfect world.

Ember has a..." name="description" /><meta content="http://cball.me.s3.amazonaws.com/loading-substates/understanding-loading-substates.jpg" name="og:image" /><meta content="Understanding Loading Substates in Ember" name="og:title" /><meta content="http://cball.me/understanding-loading-substates-in-ember/" name="og:url" /><link href="https://plus.google.com/100884992885084072433" rel="author" /><!--[if lt IE 9]><script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script><![endif]--><link href="//cloud.typography.com/6222872/746702/css/fonts.css" media="all" rel="stylesheet" type="text/css" /><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" media="all" rel="stylesheet" type="text/css" /><link href="/stylesheets/application.css" media="all" rel="stylesheet" type="text/css" /><link href="/stylesheets/print.css" media="print" rel="stylesheet" type="text/css" /></head><body class="understanding-loading-substates-in-ember understanding-loading-substates-in-ember_index"><header class="hidden-print"><div class="container"><div class="row"><div class="col-md-12"><div class="home"><a href="/"><span class="title">Level Up</span><span class="name"> by Chris Ball </span></a></div><ul class="nav nav-pills"><li><a href="/about">About</a></li><li><a href="/">Posts</a></li><li><a href="/talks">Talks</a></li><li><a href="/contact">Contact</a></li></ul></div></div></div></header><div class="container"><div class="row"><div class="col-md-10 col-md-offset-1" id="main"><article><div class="post-header"><div class="inner"><a href="/understanding-loading-substates-in-ember/"><img class="img-responsive" src="http://cball.me.s3.amazonaws.com/loading-substates/understanding-loading-substates.jpg" /></a><div class="date"><div class="month">Sep</div><div class="day"> 5</div><div class="year">2014</div></div></div></div><div class="post-body"><h2 class="title"><a href="/understanding-loading-substates-in-ember/">Understanding Loading Substates in Ember</a></h2><div class="date subtitle">September  5, 2014</div><div class="by"><a target="_blank" class="author" href="http://twitter.com/cball_"><img src="http://www.gravatar.com/avatar/6254dc2b7e4f26b2ab5d05c560834671.png" /><div class="twitter"><div><i class="fa fa-twitter"></i> cball_</div></div></a></div><hr />

<p>Ember applications (and client-side applications in general) respond quickly to user interaction. In a perfect world, the API powering your application also responds quickly, but unfortunately most of us don’t live in a perfect world.</p>

<p>Ember has a few different loading behaviors built-in to help us deal with this situation:</p>

<ul>
  <li><a href="#nested-loading-templates">Nested loading templates</a></li>
  <li><a href="#loading-event">A loading event in routes</a></li>
</ul>

<p>I’ll also show you how to <a href="#manual">use loading templates manually</a>.</p>

<p>The <a href="http://emberjs.com/guides/routing/loading-and-error-substates/">guides for loading substates</a> are excellent, so read through those if you haven’t already. Instead of just reiterating what the guides say, I'd like to try to show you visual examples using a real world application.</p>

<h4 id="our-example-app">Our example app</h4>

<p>Let’s assume we are building a Rdio clone (all Rdio screenshots are copyright them and not me) and we want to add a loading state to each section of the album page.</p>

<p><img alt="rdio UI" src="http://cball.me.s3.amazonaws.com/loading-substates/1-interface.png" /></p>

<p>Our album template is divided into the following sections:</p>

<p><img alt="rdio sections" src="http://cball.me.s3.amazonaws.com/loading-substates/2-template-sections.png" /></p>

<p>Here’s what our router and models might look like:</p>

<pre class="highlight javascript"><span class="c1">// router.js
</span><span class="nx">App</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;album&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="s1">&#39;/album/:album_id&#39;</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;activities&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resource</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{});</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// models/album.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
  <span class="na">image</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
  <span class="na">reviews</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;review&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="na">async</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}),</span>
  <span class="na">activities</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(</span><span class="s1">&#39;activity&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="na">async</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
<span class="p">});</span>

<span class="c1">// models/review.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">body</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
  <span class="na">album</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;album&#39;</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// models/activity.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">attr</span><span class="p">(),</span>
  <span class="na">album</span><span class="p">:</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="s1">&#39;album&#39;</span><span class="p">)</span>
<span class="p">});</span>
</pre>
<p>Since we are <em>nesting our UI</em> (comments and activity appears within the album template) <em>our routes are also nested</em>. We want Ember to automatically generate index routes for both activities and reviews. We don't need any other route actions, so we’ll just pass an empty function as the second argument to this.resource.</p>

<p>Also note that we're using <code>async: true</code> for the hasMany associations.</p>

<p><a name="nested-loading-templates"></a></p>

<h4 id="using-nested-loading-templates">Using nested loading templates</h4>
<p>To start things off, let’s add our application template, index template, and a top-level loading template. The loading template will automatically render when a route’s <code>beforeModel/model/afterModel</code> hook returns an unresolved promise, and then automatically render the route’s normal template in its place when the promise resolves.</p>

<p>You might have noticed that by default any of these hooks will pause a transition while the promise resolves. Once we define a loading template it will become an eager transition (meaning it will transition immediately instead of waiting for promises in our model hooks to resolve). You’ll know when a route is using an eager transition because the URL will update right away.</p>

<pre class="highlight handlebars"><span class="c">{{! templates/application.hbs }}</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h2&gt;</span>Rdio Clone<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4&gt;</span>playlists<span class="nt">&lt;/h4&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>Cool Playlist<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
    <span class="k">{{</span><span class="nv">outlet</span><span class="k">}}</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">{{! templates/index.hbs }}</span>
<span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">&quot;top-title&quot;</span><span class="nt">&gt;</span>Cool Playlist<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;albums&quot;</span><span class="nt">&gt;</span>
  <span class="k">{{#</span><span class="nn">each</span> <span class="nv">album</span> <span class="nv">in</span> <span class="nv">model</span><span class="k">}}</span>
    <span class="k">{{#</span><span class="nn">link-to</span> <span class="s1">&#39;album&#39;</span> <span class="nv">album</span> <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;album&quot;</span><span class="k">}}</span>
      <span class="nt">&lt;img</span> <span class="k">{{</span><span class="nv">bind-attr</span> <span class="nv">src</span><span class="o">=</span><span class="nv">album</span><span class="p">.</span><span class="nv">image</span><span class="k">}}</span> <span class="nt">/&gt;</span>
      <span class="k">{{</span><span class="nv">album</span><span class="p">.</span><span class="nv">title</span><span class="k">}}</span>
    <span class="k">{{/</span><span class="nn">link-to</span><span class="k">}}</span>
  <span class="k">{{/</span><span class="nn">each</span><span class="k">}}</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">{{! templates/loading.hbs }}</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;loader&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-cog fa-spin&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
  <span class="nt">&lt;p&gt;</span>Loading...<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
<p>Clicking our <em>Load an album</em> link should look like this:</p>

<p><img alt="root-loading-template" src="http://cball.me.s3.amazonaws.com/loading-substates/3-root-loading-template.gif" /></p>

<p>With this change in place, <em>any route that loads a template into the top level outlet</em> will transition to our loading template while any of its model hook promises are resolving.</p>

<p>If you look at the preview, you’ll see that we start at the root of the app. Our loading template renders in two different cases - once while the list of albums is being fetched, and another while a single album is being fetched (the page was reloaded while on the album page). The loading template does not render when navigating from the list of albums to the album view since Ember already has the required data.</p>

<p>Next, let’s say we want to show a different loading state for other items on the album page. To do this, add an album/loading template.</p>

<pre class="highlight handlebars"><span class="c">{{! templates/album/loading.hbs }}</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;loader&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-cog fa-spin&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
  <span class="nt">&lt;p&gt;</span>Fetching album data...<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
<p>Ember will load our <code>album/loading</code> template into the outlet inside the album template. That would look like this (again, with a refresh thrown in for good measure):</p>

<p><img alt="album loading" src="http://cball.me.s3.amazonaws.com/loading-substates/4-album-loading-template.gif" /></p>

<p>This looks good, so we move on to adding the review section, but realize both activities and reviews will render into the same outlet. This would be desired behavior if we were using a tabbed interface to show activities and reviews. Since we aren’t, we should use <code>named outlets</code>. For named outlets to work with loading substates, we’ll need to tell each route the outlet it should render templates into using the <code>renderTemplate</code> hook.</p>

<pre class="highlight handlebars"><span class="c">{{! templates/album.hbs }}</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;activities&quot;</span> <span class="na">class=</span><span class="s">&quot;section&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h3&gt;</span>Activity<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;div&gt;</span><span class="k">{{#</span><span class="nn">link-to</span> <span class="s1">&#39;activities&#39;</span><span class="k">}}</span>Load Activity<span class="k">{{/</span><span class="nn">link-to</span><span class="k">}}</span><span class="nt">&lt;/div&gt;</span>
  <span class="k">{{</span><span class="nv">outlet</span> <span class="nv">activities</span><span class="k">}}</span>
<span class="nt">&lt;/div&gt;</span>
      
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;reviews&quot;</span> <span class="na">class=</span><span class="s">&quot;section&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h3&gt;</span>Reviews<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;div&gt;</span><span class="k">{{#</span><span class="nn">link-to</span> <span class="s1">&#39;reviews&#39;</span><span class="k">}}</span>Load Reviews<span class="k">{{/</span><span class="nn">link-to</span><span class="k">}}</span><span class="nt">&lt;/div&gt;</span>
  <span class="k">{{</span><span class="nv">outlet</span> <span class="nv">reviews</span><span class="k">}}</span>
<span class="nt">&lt;/div&gt;</span>  
</pre>
<pre class="highlight javascript"><span class="c1">// routes/activities-index.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">model</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">album</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modelFor</span><span class="p">(</span><span class="s1">&#39;album&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">album</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;activities&#39;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="na">renderTemplate</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span> <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;activities&#39;</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// routes/activities.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">renderTemplate</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span> <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;activities&#39;</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<pre class="highlight javascript"><span class="c1">// routes/reviews-index.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">model</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">album</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modelFor</span><span class="p">(</span><span class="s1">&#39;album&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">album</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="na">renderTemplate</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span> <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;reviews&#39;</span><span class="p">});</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="c1">// routes/reviews.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">renderTemplate</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span> <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;reviews&#39;</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p>Now we’re getting closer. The loading, activity, and review templates are rendering into separate areas of the page. Ignoring for a second that loading reviews still removes activities from the UI, we can see that our <code>album/loading</code> template is being used in both cases.</p>

<p><img alt="named-outlets" src="http://cball.me.s3.amazonaws.com/loading-substates/5-named-outlets.gif" /></p>

<p>Taking things a step further, we can now add specific loading templates for both activities and reviews. Because we are using named outlets, we again need to specify where the loading templates should render. If you don’t need named outlets, you can omit the loading route code entirely.</p>

<pre class="highlight handlebars"><span class="c">{{! templates/activities/loading.hbs }}</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">“loader&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-cog fa-spin&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
  <span class="nt">&lt;p&gt;</span>Fetching activity data...<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">{{! templates/reviews/loading.hbs }}</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;loader&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-cog fa-spin&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
  <span class="nt">&lt;p&gt;</span>Fetching review data...<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
<pre class="highlight javascript"><span class="c1">// routes/activities/loading.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">renderTemplate</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span> <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;activities&#39;</span><span class="p">});</span> 
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// routes/reviews/loading.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">renderTemplate</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span> <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;reviews&#39;</span><span class="p">});</span> 
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p><img alt="separate-loading-templates" src="http://cball.me.s3.amazonaws.com/loading-substates/6-separate-loading-templates.gif" /></p>

<p>This is very close to what we need, but we're still not quite there. The UI really needs to load data without changing the URL and without removing the other sections from the page. For that we'll have to manage our loading states manually. But first, let’s discuss the <code>loading event</code>.</p>

<p><a name="loading-event"></a></p>

<h4 id="using-the-loading-event">Using the loading event</h4>
<p>If you need to do something more custom than the default loading substate behavior, Ember provides a loading event that is fired on the current route and bubbles upward to your application route.</p>

<p>To use this hook, define a loading action in the the current route or any of its parents.</p>

<pre class="highlight javascript"><span class="c1">// routes/activities.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loading</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;crazy custom stuff&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p>The loading substate behavior in Ember does not kick until the loading action fully bubbles past the ApplicationRoute. If we implement a loading action somewhere and fail to return true (like the example above) the <em>loading substate behavior will not occur</em>.</p>

<p>Our Rdio clone will eventually load our activity and review sections when the user scrolls them into view rather than when a user clicks a link. If we want to keep our existing loading template behavior but track when reviews are loaded, we could also use the loading hook. For this to work, we just need to <code>return true</code> from the loading action (which will cause the event	 to bubble up and eventually the default loading substate to occur). </p>

<pre class="highlight javascript"><span class="c1">// routes/reviews.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loading</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">postDataToAnalytics</span><span class="p">(</span><span class="s1">&#39;reviews:loaded&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p><a name="manual"></a></p>

<h4 id="using-loading-templates-manually">Using loading templates manually</h4>
<p>If you find yourself in a situation where you need loading substate type behavior, but don’t actually want to transition to a new route, you’ll have to manually implement it.</p>

<p>We can add an action that explicitly renders templates:</p>

<pre class="highlight handlebars"><span class="c">{{! templates/album.hbs }}</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="k">{{</span><span class="nv">action</span> <span class="s1">&#39;loadReviews&#39;</span> <span class="nv">model</span><span class="k">}}</span><span class="nt">&gt;</span>Load Reviews<span class="nt">&lt;/a&gt;</span>
</pre>
<pre class="highlight javascript"><span class="c1">// routes/album.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loadReviews</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">album</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;reviews/loading&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">into</span><span class="p">:</span> <span class="s1">&#39;album&#39;</span><span class="p">,</span>
        <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;reviews&#39;</span>
      <span class="p">});</span>
      
      <span class="nx">album</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">reviews</span><span class="p">){</span>
        <span class="nx">_this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;reviews/index&#39;</span><span class="p">,</span> <span class="p">{</span> 
          <span class="na">into</span><span class="p">:</span> <span class="s1">&#39;album&#39;</span><span class="p">,</span>
          <span class="na">outlet</span><span class="p">:</span> <span class="s1">&#39;reviews&#39;</span><span class="p">,</span>
          <span class="na">model</span><span class="p">:</span> <span class="nx">reviews</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p>Or we can use <code>PromiseProxyMixin</code>:</p>

<pre class="highlight javascript"><span class="c1">// controllers/reviews-index.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">ArrayController</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Ember</span><span class="p">.</span><span class="nx">PromiseProxyMixin</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">setupPromise</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;promise&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">RSVP</span><span class="p">.</span><span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(){}));</span>
  <span class="p">}.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// routes/album.js
</span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loadReviews</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">album</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">reviewsController</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">controllerFor</span><span class="p">(</span><span class="s1">&#39;reviews.index&#39;</span><span class="p">);</span>
      <span class="nx">reviewsController</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;promise&#39;</span><span class="p">,</span> <span class="nx">album</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;reviews&#39;</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<pre class="highlight handlebars"><span class="c">{{! templates/album.hbs }}</span>
…
<span class="k">{{</span><span class="nv">render</span> <span class="s1">&#39;reviews/index&#39;</span><span class="k">}}</span>
…

<span class="c">{{! templates/reviews/index.hbs }}</span>
<span class="k">{{#if</span> <span class="nv">isPending</span><span class="k">}}</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;loader&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-cog fa-spin&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
    <span class="nt">&lt;p&gt;</span>Fetching review data...<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="k">{{else}}</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;reviews&quot;</span><span class="nt">&gt;</span>
    <span class="k">{{#</span><span class="nn">each</span><span class="k">}}</span>
      <span class="nt">&lt;li&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;http://api.randomuser.me/portraits/thumb/lego/8.jpg&quot;</span> <span class="nt">/&gt;</span><span class="k">{{</span><span class="nv">body</span><span class="k">}}</span><span class="nt">&lt;/li&gt;</span>
    <span class="k">{{/</span><span class="nn">each</span><span class="k">}}</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="k">{{/if}}</span>
</pre>
<p>Since we’re now rendering inline controllers in our app, we don’t need any of the named outlet code. Additionally, the promise needs to be resolved on controller init. Otherwise, it would show our loading state immediately since null promises are considered pending.</p>

<p>With all that said, here’s our final (for now) app with loading states:</p>

<p><img alt="promise-proxy-loading" src="http://cball.me.s3.amazonaws.com/loading-substates/7-promise-proxy.gif" /></p>

<h4 id="go-forth-and-load">Go forth and load</h4>

<p>We took a pretty long route in implementing many approaches just to arrive at manual loading of templates, but in doing so I hope I’ve helped shed some light on this really interesting (and often confusing!) feature in Ember.</p>

<p>You should now know how to:</p>

<ul>
  <li>use loading templates</li>
  <li>nest loading templates</li>
  <li>use loading templates with named outlets</li>
  <li>use a loading event</li>
  <li>use manual loading states when necessary</li>
</ul>

<p>The jsbin used throughout this post is at <a href="http://jsbin.com/pikoha">http://jsbin.com/pikoha</a>.</p>
<ul class="nav tags nav-pills"><li><a href="/topics/ember/">/<span class="name">ember</span>/</a></li></ul><div class="row"><div class="col-md-8 col-md-offset-2" id="upsell"><h3>Learned something new?</h3><p>Get my best development advice (almost) every week, right in your inbox.</p><a class="btn btn-warning" href="/newsletter/">Join Level Up</a></div></div><div id="article-nav"><div class="pull-left"><a href="/non-restful-api-calls-with-ember-data/">&laquo; Non-RESTful API calls with ...</a></div><div class="pull-right"><a href="/help-i-have-no-tests/">Help I have no tests! &raquo;</a></div></div></div><div id="comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'cballme'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>

  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</article></div></div></div><footer><ul class="list-unstyled hidden-print"><li><a href="http://twitter.com/cball_">Built by <i class="fa fa-twitter"></i> cball_</a></li></ul><div class="echobind center"><a target="_blank" href="http://echobind.com"><img src="/images/echobind.png" /></a></div><p class="centered">All content &copy;2014 Chris Ball</p></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="/javascripts/application.js" type="text/javascript"></script><script type="text/javascript">// google analytics
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-46757526-1', 'auto');
ga('send', 'pageview');</script></body></html>